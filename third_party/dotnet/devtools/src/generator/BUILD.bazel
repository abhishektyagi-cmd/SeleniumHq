load("@rules_dotnet//dotnet:defs.bzl", "csharp_binary", "csharp_library", "publish_binary")
load("//dotnet:defs.bzl", "framework")

publish_binary(
    name = "generator",
    binary = ":generator-bin",
    runtime_packs = select({
        "@rules_dotnet//dotnet:rid_linux-x64": [framework("microsoft.netcore.app.runtime.linux-x64")],
        "@rules_dotnet//dotnet:rid_osx-x64": [framework("microsoft.netcore.app.runtime.osx-x64")],
        "@rules_dotnet//dotnet:rid_osx-arm64": [framework("microsoft.netcore.app.runtime.osx-x64")],
        "@rules_dotnet//dotnet:rid_win-x64": [framework("microsoft.netcore.app.runtime.win-x64")],
    }),
    self_contained = True,
    target_framework = "net6.0",
    visibility = [
        "//dotnet:__subpackages__",
    ],
)

csharp_binary(
    name = "generator-bin",
    srcs = glob(["**/*.cs"]),
    # Used as a tool in our build, so just target one framework
    target_frameworks = ["net6.0"],
    deps = [
        framework("CommandLineParser"),
        framework("Handlebars.Net"),
        framework("Humanizer.Core"),
        framework("Microsoft.CSharp"),
        framework("Microsoft.Extensions.DependencyInjection"),
        framework("Microsoft.Extensions.DependencyInjection.Abstractions"),
        framework("Microsoft.NETCore.App.Ref"),
        framework("Newtonsoft.Json"),
        framework("System.Runtime"),
    ],
)
